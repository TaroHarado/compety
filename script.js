function characterBuilder() {
  document.addEventListener("touchstart", () => {}, true);
  return {
    
    assets: {
      'Background': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/1.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/2.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/3.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/4.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/5.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/6.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/7.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/8.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/9.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/10.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/13.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/14.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/15.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/16.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/17.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/18.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/19.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/20.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/21.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/22.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/23.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/24.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/25.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/26.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/27.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/28.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/29.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Background/30.png',
        
      ],
      'Back asset': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/1.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/2.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/3.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/4.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/5.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/6.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/7.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/8.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/9.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/10.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/13.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/14.png',
         'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Back%20asset/15.png',
      ],
      'Base': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Base/1.png',
      ],
      'Clothes': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/1.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/5.png',

        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/8.png',

        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/19.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/22.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/23.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/29.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/33.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/34.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/36.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/37.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/38.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/40.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/41.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/42.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/45.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/46.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/49.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/51.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/54.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/55.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/56.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/60.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/61.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/62.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/64.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/68.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/72.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Clothes/92.png',
        
        
      ],
      'Hair': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/1.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/2.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/3.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/4.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/5.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/6.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/7.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/8.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/9.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/10.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/13.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/14.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/15.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/16.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/17.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/18.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/19.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/20.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hair/21.png',
      ],
      'Asset': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/1.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/2.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/3.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/4.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/5.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/6.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/7.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/8.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/9.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/10.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/13.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/14.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/15.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/16.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/17.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/18.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/19.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/20.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/21.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/22.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/23.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/24.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/25.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/26.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/27.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/28.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/29.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/30.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/31.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/32.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/33.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/34.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/35.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/36.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/37.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/38.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/39.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/41.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/42.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/43.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/44.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/45.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/46.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/48.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/49.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Asset/50.png',
       
      ],
      'Face': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/1%20.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/2.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/3.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/4.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/5.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/6.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/7.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/8.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/9.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/10.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/13.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/14.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/15.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/16.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/17.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/18.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/19.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/20.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/21.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/23.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/24.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/25.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/26.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/27.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/28.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Face/29.png',
      ],
      'Hand': [
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/1.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/2.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/3.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/4.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/5.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/6.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/7.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/8.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/9.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/10.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/11.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/12.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/13.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/15.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/16.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/17.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/18.png',
        'https://raw.githubusercontent.com/qasagava/Haties/refs/heads/main/assets/Hand/22.png',
        
        
      ]
    },

    layerOrder: [
      'Background', 'Back asset', 'Base', 'Clothes', 'Face', 'Hair', 'Asset', 'Hand' 
    ],

    selected: {},
    activeCategory: null,
    isPanelVisible: false,
    initialAsset: '/222.png',
    showInitialAsset: true,

    toggleHandLayer() {
  if (this.selected['Hand']) {
    this.selected['Hand'] = null;
  } else {
    this.selected['Hand'] = this.assets['Hand'][0] || null;
  }
},

    init() {
      
      this.preloadAllAssets();

      anime({
        targets: '.preview',
        opacity: [0, 1],
        scale: [0.9, 1],
        easing: 'easeOutExpo',
        duration: 800
      });

 this.imageCache = new Set();
Object.values(this.assets).flat().forEach(url => {
  const img = new Image();
  img.src = url;
  img.onload = () => this.imageCache.add(url);
});


    },

toggleCategory(layer) {
  if (this.isAnimating) {
    this.pendingCategory = layer;
    return;
  }

  if (this.activeCategory === layer) {
    this.isAnimating = true;
    this.isPanelVisible = false;

    setTimeout(() => {
      this.activeCategory = null;
      this.isAnimating = false;

      if (this.pendingCategory && this.pendingCategory !== layer) {
        const next = this.pendingCategory;
        this.pendingCategory = null;
        this.toggleCategory(next);
      }
    }, 300); // Уменьшено до 300 мс
    return;
  }

  this.isAnimating = true;
  this.activeCategory = layer;

  this.$nextTick(() => {
    this.isPanelVisible = true;

    // даже если ничего не загрузилось — вызываем колбэк
    this.waitForImagesToLoad(() => {
      this.isAnimating = false;

      if (this.pendingCategory && this.pendingCategory !== layer) {
        const next = this.pendingCategory;
        this.pendingCategory = null;
        this.toggleCategory(next);
      }
    });
  });
},

waitForImagesToLoad(callback) {
  const container = document.querySelector('.option-grid');
  if (!container) {
    setTimeout(callback, 50);
    return;
  }

  const images = container.querySelectorAll('img');
  const total = images.length;
  let loaded = 0;

  if (total === 0) {
    setTimeout(callback, 50);
    return;
  }

  images.forEach((img) => {
    img.classList.remove('loaded'); // сбрасываем перед загрузкой

    const handleLoad = () => {
      img.classList.add('loaded');
      loaded++;
      if (loaded === total) callback();
    };

    if (img.complete) {
      handleLoad();
    } else {
      img.onload = img.onerror = handleLoad;
    }
  });
},


// Отключаем анимации вовсе
animateImages() {},

select(layer, url) {
  if (layer === 'Hair') this.selected['Asset'] = null;
  if (layer === 'Asset') this.selected['Hair'] = null;

  if (this.selected[layer] === url) return;

  this.selected[layer] = null;

  const img = new Image();
  img.src = url;

  img.onload = () => {
    this.selected[layer] = url;
     this.showInitialAsset = false; 
  };
},


animateDice(icon) {
  if (!icon) return;

  // Получаем предыдущее значение вращения из data-атрибута
  let currentRotation = parseInt(icon.dataset.rotation || "0");
  let newRotation = currentRotation + 360;
  icon.dataset.rotation = newRotation;

  anime({
    targets: icon,
    rotate: newRotation,
    scale: [
      { value: 1.2, duration: 150 },
      { value: 1, duration: 200 }
    ],
    duration: 500,
    easing: 'easeInOutCubic',
  });
}
,



preloadAllAssets() {
  Object.values(this.assets).flat().forEach(url => {
    const img = new Image();
    img.src = url;
  });
},

    randomize() {
      const alwaysPick = ['Background', 'Back asset', 'Base', 'Clothes', 'Face', 'Hand'];

      alwaysPick.forEach(layer => {
        const options = this.assets[layer];
        if (options?.length) {
          const randomIndex = Math.floor(Math.random() * options.length);
          this.selected[layer] = options[randomIndex];
        }
      });

      const useHair = Math.random() > 0.5;
if (useHair) {
  const hairOptions = this.assets['Hair'];
  if (hairOptions?.length) {
    const randomIndex = Math.floor(Math.random() * hairOptions.length);
    this.selected['Hair'] = hairOptions[randomIndex];
  }
  this.selected['Asset'] = null;
} else {
  const assetOptions = this.assets['Asset'];
  if (assetOptions?.length) {
    const randomIndex = Math.floor(Math.random() * assetOptions.length);
    this.selected['Asset'] = assetOptions[randomIndex];
  }
  this.selected['Hair'] = null;
  this.showInitialAsset = false;

}


      anime({
        targets: '.preview img',
        opacity: [0, 1],
        duration: 700,
        easing: 'easeOutCubic'
      });
    },

    copyImage() {
  const node = document.getElementById('preview');
  html2canvas(node, {
    backgroundColor: null,
    useCORS: true,
    scale: 2
  }).then(canvas => {
    canvas.toBlob(blob => {
      const item = new ClipboardItem({ 'image/png': blob });
      navigator.clipboard.write([item]).then(() => {
        alert("HATIE copied to clipboard!");
      }).catch(err => {
        console.error("Copy failed:", err);
        alert("Your browser doesn't support copying images.");
      });
    });
  });
},


    downloadImage() {
      const node = document.getElementById('preview');
      html2canvas(node, {
        backgroundColor: null,
        useCORS: true,
        scale: 2
      }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'character.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    },

    slugify(str) {
      return str.toLowerCase().replace(/\s+/g, '-');
    }
    

    
  };
}


function preloader() {
    return {
      isVisible: true,
      init() {
        const images = document.images;
        let loaded = 0;
        const total = images.length;

        if (total === 0) {
          this.isVisible = false;
          return;
        }

        for (let i = 0; i < total; i++) {
          if (images[i].complete) {
            increment();
          } else {
            images[i].addEventListener('load', increment, false);
            images[i].addEventListener('error', increment, false);
          }
        }

        const that = this;
        function increment() {
          loaded++;
          if (loaded === total) {
            setTimeout(() => {
              that.isVisible = false;
            }, 500); // Задержка для красоты
          }
        }
      }
    };
  }



document.getElementById('tweet-button').addEventListener('click', function (e) {
  const tweetText = `Hey @pumpdotfun!\nHello from @compety_sol\n\n(My personal person btw)\n\n⬇️ Attach your avatar below before tweeting!`;
  const tweetURL = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tweetText)}`;
  this.href = tweetURL;
});


function copyAddress() {
  const text = document.getElementById("contract-text").innerText;
  navigator.clipboard.writeText(text)
    .then(() => {
      alert("Contract address copied!");
    })
    .catch(err => {
      console.error("Failed to copy: ", err);
    });
}


function playClickSound() {
  const sound = document.getElementById('click-sound');
  if (sound) {
    sound.currentTime = 0; // сброс на начало
    sound.play();
  }
}


const music = document.getElementById("bg-music");
const icon = document.getElementById("volume-icon");
const slider = document.getElementById("volume-slider");

let isInitialized = false;
let isPlaying = false;

icon.addEventListener("click", () => {
  if (!isInitialized) {
    music.volume = parseFloat(slider.value);
    isInitialized = true;
  }

  if (!isPlaying) {
    music.play().then(() => {
      icon.classList.add("muted");  // становится прозрачной
      isPlaying = true;
    }).catch(console.error);
  } else {
    music.pause();
    icon.classList.remove("muted"); // снова обычная
    isPlaying = false;
  }
});

slider.addEventListener("input", (e) => {
  music.volume = parseFloat(e.target.value);
});


window.addEventListener("beforeunload", function () {
  if ('caches' in window) {
    caches.keys().then(function (names) {
      for (let name of names) caches.delete(name);
    });
  }
});